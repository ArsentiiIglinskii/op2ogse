-- -*- mode: lua; coding: windows-1251-dos -*-

function attach( sm )
  sm:subscribe({ signal = "on_key_down", fun = this.on_key_down })
end


function on_key_down( key, bind )
  if key ~= DIK_keys.DIK_NUMPAD9 then return end
  if db.actor:active_slot() ~= 2 then return end
  local wpn = db.actor:active_item()
  if not wpn then return end
  if not ogse_wpn_utils.get_scope_status( wpn ) == 2 then return end
  local sect = wpn:section()
  local swpn = alife():object( wpn:id() )
  local modified_params = m_net_utils.get_weapon_data( swpn )
  modified_params.addon_flags = bit_xor( modified_params.addon_flags, 1 )
  db.actor:move_to_ruck( wpn )
  alife():release( swpn, true )
  se_item.modified_params = modified_params
  ogse.spawn_item_in_inv( sect )
end

